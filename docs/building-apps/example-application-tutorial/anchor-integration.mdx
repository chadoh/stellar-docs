---
title: Anchor Integration
sidebar_position: 60
---

An anchor is a Stellar-specific term for the on and off-ramps that connect the Stellar network to traditional financial rails, such as financial institutions or fintech companies. When a user deposits with an anchor, that anchor will credit their Stellar account with the equivalent amount of digital tokens. The user can then hold, transfer, or trade those tokens just like any other Stellar asset. When a user withdraws those tokens, the anchor redeems them for cash in hand or money in the bank. Read more about anchors in our [Anchor Documentation](https://developers.stellar.org/docs/anchoring-assets/overview).

When a customer downloads a wallet application that is connected to an anchor service, their Stellar account can either be created by the wallet application or the anchor service. In this example, the account has been created by the wallet application, BasicPay. Account creation strategies are described more in-depth [here](../application-design-considerations#account-creation-strategies).

In this example, we’ll use an anchor on Stellar’s Testnet to simulate a bank transfer into and out of the user’s wallet using [SEP-6: Deposit and Withdrawal API](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0006.md) and/or [SEP-24: Hosted Deposit and Withdrawal](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0024.md).

:::info

SEPs define standards for interoperability on Stellar. Read more in our [SEPs section](../../fundamentals-and-concepts/stellar-ecosystem-proposals).

:::

Our integrations will also use the following SEPs:

- [SEP-1: Stellar TOML](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0001.md) - a file that provides a place for the Internet to find information about an organization’s Stellar integration
- [SEP-9: Standard KYC Fields](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0009.md) - defines a list of standard KYC fields for use in Stellar ecosystem protocols
- [SEP-10: Stellar Web Authentication](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md) - defines the standard way for clients to create authenticated web sessions on behalf of a user who holds a Stellar account
- [SEP-12: KYC API](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0012.md) - defines a standard way for Stellar clients to upload KYC information to anchors

### Setup for anchored assets

First, we need to set up our application so it can communicate with anchors to get asset information.

Do this by first querying an anchor’s stellar.toml file. The [stellar.toml file](https://developers.stellar.org/docs/issuing-assets/publishing-asset-info#completing-your-stellartoml) is a common place where the Internet can find information about an organization’s Stellar integration.

For anchors, we’re interested in the `currencies` they issue, the `transfer_server` keyword that indicates if the anchor supports SEP-6, SEP-24, or both, and the `web_auth_endpoint` which allows a wallet to set up an authenticated user session.

BasicPay is interoperating with the testing anchor located at `testanchor.stellar.org` and you can view its toml file [here](https://testanchor.stellar.org/.well-known/stellar.toml).

### Anchor integration with SEP-6: Deposit and Withdrawal API

SEP-6 allows wallets and other clients to interact with anchors directly without the user needing to leave the wallet to go to the anchor’s site. In this integration, a user’s KYC information is gathered and handled by the wallet.

#### Authentication

The user must prove they own the account before they can withdraw or deposit any assets as part of SEP-10: Stellar Web Authentication.

To do this, the wallet makes a GET request with a public `account` param to the anchor, which sends back an unsigned Stellar transaction (called a challenge transaction) with an invalid sequence number so it doesn’t actually do anything when submitted to the network.

In response, the user signs the transaction, and the application POSTs it back to the anchor. If the signature checks out, the success response will contain a [JSON Web Token (JWT)](https://jwt.io/), which is stored in the `webAuthStore` store to use for future interactions with the anchor.

#### Get `/info`

First, BasicPay requests the `/info` endpoint from the anchor to understand the supported transfer methods ([deposit, withdraw, deposit-exchange, and withdraw-exchange](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0006.md)) and fee information.

#### Initiate transfer

The user then can initiate one of the transfer methods (in BasicPay, only deposits and withdraws are supported) by selecting “Deposit” or “Withdraw” from the drop-down menu and specifying the asset to be deposited or withdrawn. KYC

BasicPay then queries the anchor’s `sep-12` endpoint for the required KYC fields and presents these fields to the user. The user inputs this information and BasicPay PUTs that information to the KYC `/customer` endpoint. BasicPay then waits for the user’s `status` with the anchor to be approved.

#### Complete transfer

BasicPay then prompts the user to input additional information such as transfer type, destination, and amount.

Once approved, the user clicks “Next” and BasicPay initiates the transfer with the anchor.

In a withdrawal transaction, BasicPay will also present the user with a pre-built transaction for them to sign with their pincode.

:::info

All the fields that have been collected during this process are wrapped into a URL that contains query parameters: [example](https://testanchor.stellar.org/sep6/deposit?account=GAXQIC2BSZ5HZP3BD6RZQSD3LB66TB6A2TA5W3LZX2VDFMBAKHC4B62J&asset_code=SRT&type=bank_account&amount=11)

:::

### Anchor integration with SEP-24: Hosted Deposit and Withdrawal

SEP-24 provides a standard way for wallets and anchors to interact by having the user open a webview hosted by an anchor to collect and handle KYC information.

#### Authentication

The user must first prove they own the account before they can withdraw or deposit any assets as part of SEP-10: Stellar Web Authentication. In BasicPay, the user clicks on the “Authenticate” button, triggering a challenge transaction from the anchor to BasicPay as part of SEP-10: Stellar Web Authentication, which is then presented to the user to sign.

Once signed, BasicPay sends the transaction back to the anchor and then receives a session auth token, which is stored in the `webAuthStore` store.

#### Get `/info`

Similar to SEP-6, our application will request the `/info` endpoint from the anchor to understand the supported transfer methods (deposit, withdraw, deposit-exchange, and withdraw-exchange) and fee information.

#### Initiate and complete transfer

The user then initiates a transfer method (in BasicPay, only deposits and withdraws are supported) by POSTing a request to either the “SEP-24 Deposit” or “SEP-24 Withdraw” endpoint. The anchor then sends an interactive URL that BasicPay opens for the user to complete and confirm the transaction.

Once the user clicks “Submit”, they’ll be brought back to the application.

In a withdrawal transaction, BasicPay will also present the user with a pre-built transaction for them to sign with their pincode. `callback` should be in the form of a `postMessage`. Our application listens for that `postMessage` during the withdrawal and opens up the transaction dialog when the interactive flow is completed.
